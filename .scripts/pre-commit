#!/bin/bash

echo "*********************************************************"
echo "Running git pre-commit hook. Checking commit message convention..."
echo "*********************************************************"

# 커밋 메시지 가이드 출력
echo "Commit Message Convention Guide:"
echo "Format: 이슈 라벨/#이슈 번호: 커밋 내용"
echo "Example: Feature/#5: 캘린더에 오늘 날짜 표시 구현"
echo "Warning: 컨벤션에 맞게 커밋 메세지를 작성했는지 다시 확인해주세요!"
echo ""

# 현재 커밋 메시지 가져오기
commit_msg=$(cat "$1")

# 첫 번째 줄만 가져오기 (제목만 검사)
first_line=$(echo "$commit_msg" | head -n1)

# 커밋 메시지 패턴 검사
if ! echo "$first_line" | grep -qE '^(Feature|Hotfix|Bugfix|Refactor|Chore)/#[0-9]+: .+$'; then
    echo "Error: Commit message does not follow the convention."
    echo "커밋 컨벤션이 맞지 않아요: 이슈 라벨/#이슈 번호: 커밋 내용"
    echo "유효한 라벨을 작성해주세요: Feature, Hotfix, Bugfix, Refactor, Chore"
    echo "입력한 커밋 메시지: $first_line"
    exit 1
fi

echo "입력하신 커밋 메세지가 컨벤션에 맞아요! 커밋을 진행합니다.."
exit 0